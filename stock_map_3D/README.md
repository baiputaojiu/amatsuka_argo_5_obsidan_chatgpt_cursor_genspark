# stock_map_3D — 日付×株価×出来高の3D山脈

yfinance で取得した5分足データを銘柄ごとにCSVに保存し、日付・価格帯・出来高を計算して「3D山脈」とホバー連動の2Dグラフを表示する Dash アプリです。

- **右側**: 3Dサーフェス（日付 × 株価 × 出来高）。ホバーで座標表示。
- **左側**: 銘柄入力・取得/更新ボタン・お気に入りドロップダウン・刻み幅表示・軸範囲スライダー・3つの2Dグラフ（日付-出来高、日付-株価、出来高-株価）。日付-株価・出来高-株価には最新株価の緑点線を表示。ホバーで座標表示。
- **データ**: 5分足・過去60日。銘柄ごとに `data/{TICKER}_5m.csv` に保存。**更新ボタン**押下時のみ増分取得してCSVに追記。銘柄選択時は既存CSVを読んで計算→描画のみ。

---

## 前提

- OS: Windows 10 以降（PowerShell を想定）
- Python: 3.10 〜 3.12 程度
- 作業ディレクトリ: `stock_map_3D` フォルダ

---

## 1. 仮想環境の作成

```powershell
cd D:\workspace\amatsuka_argo_5_obsidan_chatgpt_cursor_genspark\stock_map_3D
python -m venv venv
.\venv\Scripts\Activate.ps1
```

---

## 2. 依存パッケージのインストール

```powershell
pip install -r requirements.txt
```

- dash, plotly, pandas, numpy, yfinance

---

## 3. アプリの起動

```powershell
python app.py
```

ブラウザで `http://127.0.0.1:8050/` を開く。

- 銘柄コードを入力して「取得」で初回取得→CSV保存→描画。既にCSVがある銘柄は取得せず既存データで描画。
- 「更新」で現在表示中の銘柄の5分足を増分取得→CSV追記→再描画。
- お気に入りドロップダウンで銘柄を選ぶと、既存CSVを読んで描画（取得・更新は行わない）。
- 「お気に入りに追加」で現在の銘柄を `data/favorites.json` に追加。トヨタ（7203.T）はデフォルトで登録済み。
- 価格刻みは直近終値の5％。左側に「価格刻み: ○○（直近終値 ○○ の5%）」を表示。
- X/Y/Z軸範囲スライダーで3Dの表示範囲を変更。「全体表示に戻す」でリセット。
- 3Dグラフ上でホバーすると、その点の日付・株価・出来高が表示され、左側2Dグラフがホバーした日で更新される。

---

## 4. データファイル

- `data/favorites.json`: お気に入り銘柄リスト（初期: `["7203.T"]`）
- `data/{TICKER}_5m.csv`: 銘柄ごとの5分足（Open, High, Low, Close, Volume）。日時はインデックス。

取得・更新には数秒かかることがあります。更新は「更新」ボタンを押したときのみ実行されます。
